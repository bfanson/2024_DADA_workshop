---
title: "Day 4: Shiny apps"
description: |
  A short description of the post.
author:
  - name: Ben Fanson
    url: https://bfanson.github.io/2024DADAworkshop/
    affiliation: Arthur Rylah Institute
    affiliation_url: https://www.ari.vic.gov.au/
date: 2024-09-01
output:
  distill::distill_article:
    self_contained: true
    toc: true # table of content true
    toc_float: true # make 
    depth: 3  # upto three depths of headings (specified by #, ## and ###)
    number_sections: false  ## if you want number sections at each table header
    code_folding: true # awesome buttons to show/hide the code
draft: false
slug: fanson2024dada
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, collapse = TRUE)
```

# General thoughts

1)  For Shiny Apps, the code looks foreign and a bit are you serious after all this time I spent learning R coding

2)  Once you get the basic structure, you can easily get started and then it is "Trial and Error"

# Day Objectives

1)  Understand the core structure of Shiny apps: UI, Server, Reactivity

2)  Learn how to create and run an App locally

3)  Learn how to deploy your App on ARI's shiny account

# Think about how shiny Apps might be useful

## Visualising data for clients

Ibis Tracker - Nev masterpiece

<https://arisci.shinyapps.io/ibisTracker/>

## Data sharing - upload

## Model simulations

# Reminder on a few R fundamentals

LISTS

# Creating a shiny app using Rstudio

```{r, class.source="bg-success"}
#install.packages("shiny")

```

You can find a variety of cheatsheets at <https://posit.co/resources/cheatsheets/>

```{r cheatsheet, out.width='100%', out.height='200%'}
  knitr::include_graphics("shiny.pdf")
```

<br> <br> <br> <br> <br> <br> <br> <br> <br>

``` markdown
 library(shiny) 
 ui <- fluidPage(   "Hello, world!" ) 
 server <- function(input, output, session) { } 
 shinyApp(ui, server)
```

# steps

1)  add **UI** controls
    -   this is separated by commas!!!!
    -   So many nested brackets!!!!

<!-- -->

2)  add "behaviour" to server side
    -   Shiny uses reactive programming to make apps interactive.
    -   not separated by commas...more like R programming but order does not matter!!! (except if within a reactive() or renderXXX() function
    -   R code within reactive() and renderXXX() functions
    -   double-breaks renderXXX({ }} when multiple lines

<!-- -->

3)  declare your package, global objects prior to setting up your **UI** and **Server**

# Shiny Templates

-   how might you look it up

extras at \< <https://github.com/nanxstats/awesome-shiny-extensions>\>

# AI shiny apps

# Exercise

Let's create replicate Examples <https://shiny.posit.co/r/gallery/>

# Walk through of creating App for our dataset

## App design

## Let's build something

# Jumping back to workflow for Apps

This will become pretty useful for collaborations and your own self-learning. Also, we now have a ARI shiny account and consistency allows for increased sharing and understanding.

# Useful interactive packages for shiny

can check <https://r-graph-gallery.com/interactive-charts.html>

## leaflet

## plotly

```{r out.height='500px', out.width='500px'}
  library(ggplot2)
  library(plotly)
  f <- ggplot( cars, aes(speed, dist)  ) + geom_point() + geom_smooth()
   plotly::ggplotly(f)

```

<br> <br> <br>

How a shiny App code might look of the above...

```{r dwnldPlotly, echo=FALSE, code_folding = FALSE}
library(downloadthis)
  download_file(
    path='examples/appPlotly.R',
    output_name = "appPlotly",
    button_label = "Download Shiny App for plotly",
    button_type = "warning",
    has_icon = TRUE,
    icon = "fa fa-save"
  )
```

<br>

## ggiraph

-   I like this one for linking up plots...below, put your cursor over a dot on the left or a bar on the right

-   If you know CSS, can be pretty powerful...

```{r }
library(ggiraph)
library(tidyverse)
library(patchwork)

mtcars_db <- rownames_to_column(mtcars, var = "carname")

# First plot: Scatter plot
fig_pt <- ggplot(
  data = mtcars_db,
  mapping = aes(
    x = disp, y = qsec,
    tooltip = carname, data_id = carname
  )
) +
  geom_point_interactive(
    size = 3, hover_nearest = TRUE
  ) +
  labs(
    title = "Displacement vs Quarter Mile",
    x = "Displacement", y = "Quarter Mile"
  ) +
  theme_bw()

# Second plot: Bar plot
fig_bar <- ggplot(
  data = mtcars_db,
  mapping = aes(
    x = reorder(carname, mpg), y = mpg,
    tooltip = paste("Car:", carname, "<br>MPG:", mpg),
    data_id = carname
  )
) +
  geom_col_interactive(fill = "skyblue") +
  coord_flip() +
  labs(
    title = "Miles per Gallon by Car",
    x = "Car", y = "Miles per Gallon"
  ) +
  theme_bw()

# Combine the plots using patchwork
 combined_plot <- fig_pt + fig_bar + plot_layout(ncol = 2) 

# Combine the plots using cowplot
# combined_plot <- cowplot::plot_grid(fig_pt, fig_bar, ncol=2) 

# Create a single interactive plot with both subplots
interactive_plot <- girafe(ggobj = combined_plot)

# Set options for the interactive plot
girafe_options(
  interactive_plot,
  opts_hover(css = "fill:cyan;stroke:black;cursor:pointer;"),
  opts_selection(type = "single", css = "fill:red;stroke:black;")
)
```

<br>

How a shiny App code might look of the above...

```{r dwnldGgiraph, echo=FALSE, code_folding = FALSE}
library(downloadthis)
  download_file(
    path='examples/appGgiraph.R',
    output_name = "appGgiraph",
    button_label = "Download Shiny App for ggiraph",
    button_type = "warning",
    has_icon = TRUE,
    icon = "fa fa-save"
  )
```

<br>

# Deploy your App

## ARI shiny account

## rsconnect package

```{r eval=F, class.source="bg-danger", class.output="bg-warning"}
install.packages('rsconnect')
```

``` markdown
install.packages('rsconnect')
```

``` markdown
rsconnect::setAccountInfo(name="<ACCOUNT>", token="<TOKEN>", secret="<SECRET>")
```

# Shot bit on layouts

<https://shiny.posit.co/r/layouts/>

# Beyond showing results

## Uploading files

## Saving user inputs

## Downloading

# Additional resources

For useful resources: <https://shiny.posit.co/r/articles/> For useful examples: <https://shiny.posit.co/r/articles/>

see <https://mastering-shiny.org/>

<aside>Asides can be useful for preso.</aside>
